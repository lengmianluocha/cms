<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

    <head th:replace="common/head::head"></head>

	<body class="no-skin">

	<div th:replace="common/navbar ::#navbar"></div>

		<div class="main-container ace-save-state" id="main-container">

           <div th:replace="common/sidebar::sidebar"> </div>

			<div class="main-content">


				<div class="main-content-inner">
					<div class="breadcrumbs ace-save-state" id="breadcrumbs">
						<ul class="breadcrumb">
							<li>
								<i class="ace-icon fa fa-home home-icon"></i>
								<a href="#">Home</a>
							</li>

							<li>
								<a href="/moive/addview">增加电影</a>
							</li>
						</ul><!-- /.breadcrumb -->
					</div>

					<div class="page-content">

						<div >

							<div style="float: left">
								<button class="btn btn-sm btn-primary" id=a"reset">重置文件</button>
								<a role="button" class="btn btn-sm btn-primary" id="upload" href="#my-modal" data-toggle="modal">上传</a>
							</div>

						</div>



						<br/>
						<br/>

						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="row">
									<div class="col-xs-12">

											<table id="dynamic-table" class="table table-striped table-bordered table-hover">
												<thead>
													<tr>
														<th class="center"></th>
														<th>电影名</th>
														<th>网盘地址</th>
														<th>访问地址</th>
														<th>密码</th>
														<th>操作</th>
													</tr>
												</thead>
												<tbody>
												</tbody>
											</table>
										</div>
								</div>
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div>
			</div><!-- /.main-content -->


			<div id="my-modal" class="modal fade" tabindex="-1">
				<!--<form id="fileForm" method="post" action="/moive/upload"  enctype="multipart/form-data">-->
				<form id="fileForm">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h3 class="smaller lighter blue no-margin">批量导入</h3>
						</div>

						<div class="modal-body">
							<div class="row">

								<div class="form-group">
									<div class="col-xs-8">
										<input type="file" name="file"  class="form-control" id="id-input-file-2" />
									</div>
								</div>

							</div>
						</div>

						<div class="modal-footer">
							<!--<button class="btn btn-sm btn-success pull-left" id="fileSubmit" type="submit">-->
							<button class="btn btn-sm btn-success pull-left" id="fileSubmit" type="button" data-dismiss="modal">
								提交
							</button>
							<button class="btn btn-sm btn-danger pull-right" data-dismiss="modal">
								<i class="ace-icon fa fa-times"></i>
								取消
							</button>
						</div>
					</div><!-- /.modal-content -->
				</div><!-- /.modal-dialog -->
				</form>
			</div>

			<div th:replace="common/footer::footer"></div>
		</div><!-- /.main-container -->

		<!-- basic scripts -->
		<script src="../../static/assets/js/jquery-2.1.4.min.js"></script>
		<script src="../../static/assets/js/bootstrap.min.js"></script>
		<!-- page specific plugin scripts -->
		<script src="../../static/assets/js/jquery.dataTables.min.js"></script>
		<script src="../../static/assets/js/jquery.dataTables.bootstrap.min.js"></script>
		<script src="../../static/assets/js/dataTables.buttons.min.js"></script>
		<script src="../../static/assets/js/buttons.flash.min.js"></script>
		<script src="../../static/assets/js/buttons.html5.min.js"></script>
		<script src="../../static/assets/js/buttons.print.min.js"></script>
		<script src="../../static/assets/js/buttons.colVis.min.js"></script>
		<script src="../../static/assets/js/dataTables.select.min.js"></script>

		<!-- ace scripts -->
		<script src="../../static/assets/js/ace-elements.min.js"></script>
		<script src="../../static/assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">

			jQuery(function($) {
			    $("#reset").click(function(){
			        var param ='';
			        $.post('/moive/reset',param,function(data){
			            alert("success");
					});
				});
				//initiate dataTables plugin
				var myTable = 
				$('#dynamic-table')
				.DataTable({
                    "processing": true,//刷新的那个对话框
                    "serverSide": true,//服务器端获取数据
					search:true,
                    //bFilter: false,
                    "paging": true,//开启分页
                    ordering:false,
                    lengthMenu: [ //自定义分页长度
                        [ 20, 30, 50 ],
                        [ '20 页', '30 页', '50 页' ]
                    ],
					ajax:{
					    "url":'/moive/list2',
                        "type": "POST"
                    },
                    columns:
						[
						{"data": "id", "defaultContent": ""},
						{"data": "mname", "defaultContent": ""},
						{"data": "panurl", "defaultContent": ""},
						{"data": "murl", "defaultContent": ""},
						{"data": "panpwd", "defaultContent": ""},
						{"data": "", "defaultContent": "<a class='btn btn-minier btn-yellow'>修改</a>"}
						]
					,
                });

                //myTable
                $('#dynamic-table').on("click","a.btn-minier",function(){
                    var data = myTable.row($(this).parent().parent('tr')).data();
                   	var id =data.id;
                   	$(this).attr("href","/moive/updateView?id="+id);
				});

			})

            $('#id-input-file-1 , #id-input-file-2').ace_file_input({
                no_file:'No File ...',
                btn_choose:'Choose',
                btn_change:'Change',
                droppable:false,
                onchange:null,
                thumbnail:false //| true | large
                //whitelist:'gif|png|jpg|jpeg'
                //blacklist:'exe|php'
                //onchange:''
                //
            });

			$("#fileSubmit").click(function(){
                var form = new FormData();
                var file = $("#id-input-file-2")[0].files[0];
                form.append('file',file);

                $.ajax({
                        type: "POST",
                        url: "/moive/upload",
						data:form,
                        processData:false,
                        contentType:false,
						dataType:"json",
                        success:function (data) {
                            console.log(data);   //data即为后台返回的数据
                        }
                    });

			   // $("#fileForm").submit();
			});
		</script>
	</body>
</html>
